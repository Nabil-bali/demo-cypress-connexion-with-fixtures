var e=require("path"),t=require("mime");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r,o=n(e),i=Object.freeze({subjectType:"input",force:!1,allowEmpty:!1}),s=Object.freeze({INPUT:"input",DRAG_N_DROP:"drag-n-drop"}),a=((r={})[s.INPUT]=["change"],r[s.DRAG_N_DROP]=["dragstart","drag","dragenter","drop","change","dragleave","dragend"],r);function f(e,t){e.files&&e.files.length>0&&Array.prototype.forEach.call(e.files,function(e){return t.items.add(e)}),e.files=t.files}function c(e,t,n){t.forEach(function(t){!function(e,t,n){var r={bubbles:!0,cancelable:!0,detail:n};try{var o=new CustomEvent(t,r);Object.assign(o,{dataTransfer:n}),e.dispatchEvent(o)}catch(o){}}(e,t,n)})}function u(e){return"string"==typeof e?{filePath:e,encoding:"",mimeType:"",fileName:o.default.basename(e)}:{filePath:e.filePath,encoding:e.encoding||"",mimeType:e.mimeType||"",fileName:e.fileName||o.default.basename(e.filePath),fileContent:e.fileContent}}function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function d(e,t,n){return(d=m()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&y(o,n.prototype),o}).apply(null,arguments)}function v(e){var t="function"==typeof Map?new Map:void 0;return(v=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return d(e,arguments,p(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),y(n,e)})(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var g={message:'"subjectType" is not valid',tip:'Please look into docs to find supported "subjectType" values'},T={message:'"force" is not valid',tip:'Please look into docs to find supported "force" values'},P={message:'"allowEmpty" is not valid',tip:'Please look into docs to find supported "allowEmpty" values'},b={message:'"file encoding" is not valid',tip:'Please look into docs to find supported "encoding" values'},w={message:'"filePath" is not valid',tip:'Please look into docs to find supported "filePath" values'},C={message:'"mimeType" is not valid',tip:'Please look into docs to find supported "mimeType" values'},E={message:"given fixture file is empty",tip:'Please make sure you provide correct file or explicitly set "allowEmpty" to true'},F={message:'missing "filePath" or "fileName"',tip:'Please make sure you are passing either "filePath" or "fileName"'},S=function(e){var t,n;function r(t){var n;return n=e.call.apply(e,[this].concat([].slice.call(arguments,1)))||this,Error.captureStackTrace&&Error.captureStackTrace(h(n),r),n.name="[cypress-file-upload error]",n.message=t.message+".\n"+t.tip,n}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r}(v(Error)),O=Object.freeze({ASCII:"ascii",BASE64:"base64",BINARY:"binary",HEX:"hex",LATIN1:"latin1",UTF8:"utf8",UTF_8:"utf-8",UCS2:"ucs2",UCS_2:"ucs-2",UTF16LE:"utf16le",UTF_16LE:"utf-16le"}),N=Object.freeze({JSON:"json",JS:"js",COFFEE:"coffee",HTML:"html",TXT:"txt",CSV:"csv",PNG:"png",JPG:"jpg",JPEG:"jpeg",GIF:"gif",TIF:"tif",TIFF:"tiff",ZIP:"zip",PDF:"pdf",VCF:"vcf",SVG:"svg",XLS:"xls",XLSX:"xlsx",DOC:"doc",DOCX:"docx",MP3:"mp3"}),j=Object.values(O);function A(e){var t=e.filePath,n=e.fileName,r=e.encoding,o=e.mimeType,i=e.fileContent;if(r&&!j.includes(r))throw new S(b);if("string"!=typeof t&&!i)throw new S(w);if("string"!=typeof o)throw new S(C);if(!t&&!n)throw new S(F);return!0}var I,U,_=function(e){return e instanceof Cypress.Promise?e:(delete e.then,Cypress.Promise.resolve(e))},B=((I={})[O.ASCII]=function(e){return Cypress.Promise.resolve(e)},I[O.BASE64]=function(e,t){return _(Cypress.Blob.base64StringToBlob(e,t))},I[O.BINARY]=function(e,t){return _(Cypress.Blob.binaryStringToBlob(e,t))},I[O.HEX]=function(e){return Cypress.Promise.resolve(e)},I[O.LATIN1]=function(e){return Cypress.Promise.resolve(e)},I[O.UTF8]=function(e){return Cypress.Promise.resolve(e)},I[O.UTF_8]=function(e){return Cypress.Promise.resolve(e)},I[O.UCS2]=function(e){return Cypress.Promise.resolve(e)},I[O.UCS_2]=function(e){return Cypress.Promise.resolve(e)},I[O.UTF16LE]=function(e){return Cypress.Promise.resolve(e)},I[O.UTF_16LE]=function(e){return Cypress.Promise.resolve(e)},I),R=((U={})[N.JSON]=O.UTF8,U[N.JS]=O.UTF8,U[N.COFFEE]=O.UTF8,U[N.HTML]=O.UTF8,U[N.TXT]=O.UTF8,U[N.CSV]=O.UTF8,U[N.PNG]=O.BASE64,U[N.JPG]=O.BASE64,U[N.JPEG]=O.BASE64,U[N.GIF]=O.BASE64,U[N.TIF]=O.BASE64,U[N.TIFF]=O.BASE64,U[N.ZIP]=O.BASE64,U[N.PDF]=O.UTF8,U[N.VCF]=O.UTF8,U[N.SVG]=O.UTF8,U[N.XLS]=O.BINARY,U[N.XLSX]=O.BINARY,U[N.DOC]=O.BINARY,U[N.DOCX]=O.BINARY,U[N.MP3]=O.BINARY,U),x=O.UTF8;Cypress.Commands.add("attachFile",{prevSubject:!0},function(n,r,o){var p,y,m=(void 0===(p=o)&&(p={}),void 0===(y=i)&&(y={}),l({},y,p)),d=m.subjectType,v=m.force,h=m.allowEmpty;!function(e){var t=e.subjectType,n=e.force,r=e.allowEmpty;if(-1===Object.values(s).indexOf(t))throw new S(g);if("boolean"!=typeof n)throw new S(T);if("boolean"!=typeof r)throw new S(P)}({subjectType:d,force:v,allowEmpty:h});var b=(Array.isArray(r)?r:[r]).map(u).filter(A);return Cypress.cy.window({log:!1}).then(function(r){var o=v||function(e){return!("chrome"===(t=Cypress.browser).name&&t.majorVersion<73&&function(e){if(!e)throw new Error("Element cannot be empty");return Cypress.dom.isAttached(e)&&Cypress.dom.isVisible(e)}(e))||function(e){if(!e)throw new Error("Element cannot be empty");return Cypress.dom.isDetached(e)}(e);var t}(n);Cypress.Promise.all(b.map(function(n){return function(n,r){var o=n.filePath,i=n.encoding,s=n.fileName,a=n.mimeType||function(n){var r=e.extname(n).slice(1);return t.getType(r)}(o),f=i||function(t){var n=e.extname(t).slice(1);return R[n]||x}(o);return new Cypress.Promise(function(t){return function(e){var t=e.filePath,n=e.fileContent,r=e.fileEncoding;return n?_(n):Cypress.cy.fixture(t,r)}({filePath:o,fileContent:n.fileContent,fileEncoding:f}).then(function(t){return function(t){var n=t.fileName,r=t.fileContent,o=t.mimeType,i=t.window;return(0,B[t.encoding])(r,o).then(function(t){var s=t;return e.extname(n).slice(1)===N.JSON&&(s=JSON.stringify(r,null,2)),new i.File([s],n,{type:o})})}({fileContent:t,fileName:s,mimeType:a,encoding:f,window:r})}).then(t)})}(n,r)})).then(function(e){return e.filter(function(e){return function(e,t){if(!t&&0===e.size)throw new S(E);return!0}(e,h)})}).then(function(e){return function(e,t){var n=t.files,r=t.subjectType,o=t.force,i=new t.window.DataTransfer;if(n.forEach(function(e){return i.items.add(e)}),r===s.INPUT){var u=e[0];f(u,i),o&&c(u,a[r],i)}else if(r===s.DRAG_N_DROP){var l=e[0].querySelectorAll('input[type="file"]');if(1===l.length){var p=l[0];f(p,i),o&&c(p,a[r],i)}else{var y=e[0];f(y,i),o&&c(y,a[r],i)}}}(n,{files:e,subjectType:d,force:o,window:r}),e}).then(function(e){return Cypress.log({name:"attachFile",displayName:"FILE",message:e.reduce(function(e,t){return""+(e.length>0?e+", ":e)+t.name},"")})})}),Cypress.cy.wrap(n,{log:!1})});
//# sourceMappingURL=bundle.js.map
